# Squid Proxy Configuration for Notion API
# Only allows connections to Notion domains

# Port configuration
http_port 3128

# Access Control Lists (ACL)
acl allowed_domains dstdomain .notion.so api.notion.com
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl CONNECT method CONNECT

# Access rules
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow allowed_domains
http_access deny all

# Logging - JSON format for structured logs
logformat json {"timestamp":"%{%Y-%m-%dT%H:%M:%S}tl","level":"INFO","src_ip":"%>a","dst_host":"%{Host}>h","method":"%rm","url":"%ru","status":%>Hs,"size":%<st,"duration":%tr}
access_log /var/log/squid/access.log json

# Cache configuration - Disabled for security
cache deny all

# Timeout settings
connect_timeout 60 seconds
read_timeout 300 seconds
request_timeout 60 seconds

# Memory and disk cache (disabled)
cache_mem 0 MB
maximum_object_size 0 KB

# Miscellaneous
coredump_dir /var/spool/squid
refresh_pattern . 0 0% 0
shutdown_lifetime 3 seconds
